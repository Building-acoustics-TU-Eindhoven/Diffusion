

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diffusion Equation Code 2D documentation &mdash; Diffusion Equation for Acoustics 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Diffusion Equation for Acoustics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Software Presentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Overview.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Use:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Finite%20Different%20Method%20Use.html">Finite Different Method Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="Finite%20Volume%20Method%20Use.html">Finite Volume Method Use</a></li>
<li class="toctree-l1"><a class="reference internal" href="Auralization%20Use.html">Auralization Use</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Theory:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="DocumentationFDM.html">Diffusion Equation Finite Different Method (FDM) documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="DocumentationFVM.html">Diffusion Equation Finite Volume Method (FVM) Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="DocumentationAuralization.html">Auralization Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Finite%20Different%20Method%20Demo%20Tutorial.html">Finite Different Method Demo Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Finite%20Volume%20Method%20Demo%20Tutorial.html">Finite Volume Method Demo Tutorial</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Diffusion Equation for Acoustics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Diffusion Equation Code 2D documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Documentation2D.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="diffusion-equation-code-2d-documentation">
<h1>Diffusion Equation Code 2D documentation<a class="headerlink" href="#diffusion-equation-code-2d-documentation" title="Link to this heading"></a></h1>
<p>The code is based on the Du Fort and Frankel method (explicit unconditionally stable Finite difference method).</p>
<section id="objectives-what-it-can-do">
<h2>Objectives/what it can do<a class="headerlink" href="#objectives-what-it-can-do" title="Link to this heading"></a></h2>
<p>This code can calculate the acoustics energy density over time and space. It will give an acoustics energy distribution of the plane xy.</p>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading"></a></h2>
<p>Install Spyder 5.4.2</p>
</section>
<section id="libraries">
<h2>Libraries<a class="headerlink" href="#libraries" title="Link to this heading"></a></h2>
<p>To properly run the cose, the following libraries are needed:</p>
<ul class="simple">
<li><p>Python version 3.10.9 installed through Anaconda</p></li>
<li><p>Libraries for python:</p></li>
<li><p>import math</p></li>
<li><p>import matplotlib.pyplot as plt #import matplotlib as mpl</p></li>
<li><p>import numpy as np</p></li>
<li><p>from math import ceil</p></li>
<li><p>from math import log</p></li>
<li><p>from math import pi</p></li>
<li><p>from FunctionRT import t60_decay</p></li>
</ul>
</section>
<section id="inputs">
<h2>Inputs<a class="headerlink" href="#inputs" title="Link to this heading"></a></h2>
<p>The inputs are:</p>
<ul class="simple">
<li><p>Length of the line x direction lxmax in m and line in y direction in m;</p></li>
<li><p>Air absorption m_atm in 1/m;</p></li>
<li><p>Distance between grid points dx and dy in m; (use a dx multiple of the dimensions of the rooms, e.g. 0.5m or 0.2m for a 3x3x3 room and not 0.4m)</p></li>
<li><p>Distance between grid points on the time discretization dt in s;</p></li>
<li><p>Recording time of the calculation in s;</p></li>
<li><p>Source time (time of the source beeing on before interrupting);</p></li>
<li><p>Absorption conditions term (option 1 Sabine, 2 Eyring, 3 Modified);</p></li>
<li><p>Absorption coefficient of the surface alpha for one frequency only;</p></li>
<li><p>Source point power Ws in Watts;</p></li>
<li><p>Volume of the source Vs in m^3;</p></li>
<li><p>Position of the source x_source,y_source in m in the x,y directions;</p></li>
<li><p>Position of the receiver x_rec,y_rec in m in the x,y directions.</p></li>
</ul>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Geometry model - Set up the dimension of the plane \</p></li>
<li><p>Set up the spatial distribution and temporal distribution (dx, dy and dt) \</p></li>
<li><p>Calculate Absorption term based on one absorption coefficient and the type of absorption condition (Sabine, Eyring or Modified) \</p></li>
<li><p>Define Diffusion coefficient Dx and Dy as constants:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[Dx = Dy = (λc)/3\]</div>
<p>Where:
λ = mean free path</p>
<ol class="arabic simple" start="5">
<li><p>Define stability criterion (Eq. 18 of Navarro 2012) \</p></li>
</ol>
<div class="math notranslate nohighlight">
\[(β_0^{-1}/(1+β_0^2+2β_0)≤ 1\]</div>
<p>Where beta_zero comes from the discretization of the diffusion equation.</p>
<ol class="arabic simple" start="6">
<li><p>Define source:<br />
The source is positioned at x,y (to define) in the plane and it changes over time depending on the recording time and the source time. The source is defined with intermittant noise level.</p></li>
<li><p>Define receiver: <br />
The receiver position will need to be defined.</p></li>
<li><p>Define the energy density temporal discretization:<br />
<img alt="" src="1DGrid.png" /></p></li>
</ol>
<ul class="simple">
<li><p>w_new = unknown energy density at new time level (n+1)</p></li>
<li><p>w = energy density at n level</p></li>
<li><p>w_old = energy density at n-1 level</p></li>
</ul>
<ol class="arabic simple" start="9">
<li><p>According to Dufort and Frankel method, the discretaization is based on the following image – based on Navarro 2012 \</p></li>
</ol>
<ul class="simple">
<li><p>i is the spatial element along x direction</p></li>
<li><p>j is the spatial element along y direction</p></li>
<li><p>n is the temporal element</p></li>
</ul>
<p>The partial differential equation is:</p>
<div class="math notranslate nohighlight">
\[∂w/∂t- D((∂^2 w)/(∂x^2 )+(∂^2 w)/(∂y^2 ))+ cmw=Pδ(r-r_s ) in V\]</div>
<p>Each term of the equation is discretized as follows:</p>
<div class="math notranslate nohighlight">
\[∂w/∂t=(w_{i,j}^{n+1}- w_{i,j}^{n-1})/(2∆t)\]</div>
<div class="math notranslate nohighlight">
\[∂^2 w/∂x^2=(w_{i+1,j}^n - 2((w_{i,j}^{n+1}+w_{i,j}^{n-1})/2)+w_{i-1,j}^n)/(∆x)^2\]</div>
<div class="math notranslate nohighlight">
\[∂^2 w/∂y^2=(w_{i,j+1}^n - 2((w_{i,j}^{n+1}+w_{i,j}^{n-1})/2)+w_{i,j-1}^n)/(∆y)^2\]</div>
<div class="math notranslate nohighlight">
\[cmw=cmw_{i,j}^n\]</div>
<div class="math notranslate nohighlight">
\[Pδ(r-r_s )=P_{i,j}^n\]</div>
<p>The full discretised equation is:</p>
<div class="math notranslate nohighlight">
\[w_{i,j}^{n+1}=   (w_{i,j}^{n-1}(1-β_{0} )-2∆tc_0mw_{i,j}^n - 2∆tP_{i_s,j_s}^n + β_{0{x}}(w_{i+1,j}^n+ w_{i-1,j}^n )++ β_{0{y}}(w_{i,j+1}^n+ w_{i,j-1}^n ))/(1+ β_{0})\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[β_{0{x}}=β_{0{y}}=(2D∆t)/(∆x)^2 \]</div>
<p>And</p>
<div class="math notranslate nohighlight">
\[β_{0}=β_{0{x}}+β_{0{y}} \]</div>
<p>And</p>
<div class="math notranslate nohighlight">
\[c_0=343 m/s\]</div>
<p>P_(i_s,j_s)^n=source term (soft source) at position i_s,j_s and at the time step of n; this comes from the source term function (Navarro 2012) <span class="math notranslate nohighlight">\(w_{i_s,j_s}^{n+1}= w_{i_s,j_s}^{n+1}+2∆tP_{i_s,j_s}^n\)</span></p>
<p>m = air absorption coefficient = 0 from Billon paper 2008</p>
<ol class="arabic simple" start="10">
<li><p>Define boundary conditions:<br />
:::{table} Boundary conditions
:widths: auto
:align: center</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Boundaries</p></th>
<th class="head"><p>Formula</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Boundary at x = 0</p></td>
<td><p><span class="math notranslate nohighlight">\(D ∂w/∂x-cA_x w=0\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Boundary at y = 0</p></td>
<td><p><span class="math notranslate nohighlight">\(D ∂w/∂y-cA_y w=0\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Boundary at x = Lx</p></td>
<td><p><span class="math notranslate nohighlight">\(D ∂w/∂x+cA_x w=0\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Boundary at y = Lx</p></td>
<td><p><span class="math notranslate nohighlight">\(D ∂w/∂y+cA_y w=0\)</span></p></td>
</tr>
<tr class="row-even"><td><p>:::</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>The discretized equations are based on the forward and backward three points formula (Necati book). Only the one directional formulas have been included as examples.\</p>
<p>Forward Difference Approximation (first derivative - three points formula) for x=0</p>
<div class="math notranslate nohighlight">
\[∂w/∂x=(-3 w_{0}^{n+1}+4w_{1}^{n+1}- w_{2}^{n+1})/(2∆x)\]</div>
<p>Backward Difference Approximation (first derivative - three points formula) for x=Lx</p>
<div class="math notranslate nohighlight">
\[∂w/∂x=(3 w_{L_x}^{n+1}-4w_{L_{x-1}}^{n+1}+ w_{L_{x-2}}^{n+1})/(2∆x)\]</div>
<p>And the discretized boundary reshaped are:<br />
Boundary at x = 0</p>
<div class="math notranslate nohighlight">
\[w_{0}^{n+1}=   (4w_{1}^{n+1}-2w_{2}^{n+1})/(3+(2 A_{x_{0}}∆x)/D_{x})\]</div>
<p>Boundary at x = Lx</p>
<div class="math notranslate nohighlight">
\[w_{L_{x}}^{n+1}=   (4w_{L_{x-1}}^{n+1}-2w_{L_{x-2}}^{n+1})/(3+(2 A_{x_{L_x}}∆x)/D_{x})\]</div>
<ol class="arabic simple" start="11">
<li><p>Calculate Sound Density Level and Sound Pressure Level:\</p></li>
</ol>
<div class="math notranslate nohighlight">
\[SDL = 10 log_10⁡(w_{i,j}^{n+1})\]</div>
<div class="math notranslate nohighlight">
\[SPL = 20 log_10⁡(((w_{i_r,j_r}^{n+1}ρc_{0}^2 ))/p_{ref}^2) \]</div>
<ol class="arabic simple" start="12">
<li><p>Calculate Reverberation time:<br />
The Reverberation time is calculated using backward integration and in between -5 and -35 dB difference.</p></li>
<li><p>Calculate Clarity, Definition and Centre Time<br />
The values are calculate from the Barron’s revisited theory formulas (Vorlander 2008) with the influence of the direct field neglected.</p></li>
</ol>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>J. M. Navarro, J. Escolano and J. J. Lopez, Implementation and evaluation of a diffusion equa-tion model based on finite difference schemes for sound field prediction in rooms,Appl. Acoust.73(2012) 659–665.</p></li>
<li><p>Billon A, Picaut J, Foy C, Valeau V, Sakout A. Introducing atmospheric attenuation within a diffusion model for room-acoustic predictions. J Acoust Soc Am. 2008 Jun;123(6):4040-3. doi: 10.1121/1.2903872. PMID: 18537354.</p></li>
<li><p>Vorländer M. Auralization: fundamentals of acoustics, modelling, simulation,algorithms and acoustic virtual reality. Springer 2008</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Ilaria Fichera.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>